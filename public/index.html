<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="main.css">
  <title>Mercury</title>
</head>

<body>
  <div id="friends" class="col-sm-4">

  </div>
   <div id="createoverlay" class="container">
    <div class="form-group">
      <label for="usernameBoxCreate" id="username">Username:</label>
      <input type="text" class="form-control" id="usernameBoxCreate" autocomplete="off" />
    </div>
    <div class="form-group">
      <label for="passwordBoxCreate" id="passwordCreate">Password:</label>
      <input type="password" class="form-control" id="passwordBoxCreate" autocomplete="off" />
    </div>
    <div class="form-group">
      <label for="emailBoxCreate" id="email">Email:</label>
      <input type="email" class="form-control" id="emailBoxCreate" autocomplete="off" />
    </div>
    <button id="submit">Submit</button>
    <button id="back">Back</button>
  </div>

  <div id="overlay" class="container">
    <button id="login">Login</button>
    <button id="create">Create Account</button>
    <input id="usernameBox" autocomplete="off" />
    <input id="passwordBox" autocomplete="off" type="password"/>
    <label id="username">Username:</label>
    <label id="password">Password:</label>
  </div>
  <div>
    <ul id="messages" class="col-sm-8"></ul>
    <form id="textBoxButtons" action="">
      <input id="m" autocomplete="off" />
      <button id="sendBut">Send</button>
    </form>
    </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  
  <script>
  $(function () {//wait for document to fully load before running javascript
    var socket = io();

  //toggle off all elements we dont want to see immediately
    $('#messages').toggle();
    $('#textBoxButtons').toggle();
    $('#m').toggle();
    $('#sendBut').toggle();
    $('#friends').toggle();

  //do this when login button clicked
    $('#login').on('click',function(login){
        login.preventDefault(); // prevents page reloading
        socket.emit('loginid', $('#usernameBox').val(), $('#passwordBox').val());
        $('#usernameBox').val('');
        $('#passwordBox').val('');
        return false;
      });

  //do this when create account button clicked
    $('#create').on('click',function(create){ //bring up create account page
        create.preventDefault(); // prevents page reloading
        $('#overlay').toggle(300, function() {$('#createoverlay').toggle(300); });
        return false;
      });

  //do this when back button clicked
    $('#back').on('click',function(back){ //close create account page
        back.preventDefault(); // prevents page reloading
        $('#createoverlay').toggle(300, function() {$('#overlay').toggle(300); });
        return false;
      });

  //do this when submit button clicked
    $('#submit').on('click',function(submit){ //submit account creation
        submit.preventDefault(); // prevents page reloading
        socket.emit('submit',$('#usernameBoxCreate').val(), $('#passwordBoxCreate').val(),$('#emailBoxCreate').val());
        return false;
      });

    //do this when send message button clicked
    $('#sendBut').on('click',function(e){ //send message
      e.preventDefault(); // prevents page reloading
      socket.emit('chat message', $('#m').val());
      $('#m').val('');
      return false;
    });

    //if you press enter after typing password, will attempt login
    $("#passwordBox").keyup(function(event) {
        if (event.keyCode === 13) {
            $("#login").click();
        }
    });

  //these socket.on's are called by client for dialog boxes,chat messages, etc. Not directly used by client.
    socket.on('chat message', function(msg){ //receive message
      $('#messages').append($('<li>').text(msg));
      $('#messages').scrollTop($('#messages')[0].scrollHeight);
    });
    socket.on('loginsuccess',function(){ //login succeeded
        $('#overlay').fadeOut(300, function(){
        	$('#friends').fadeIn(300);
        	$('#messages').fadeIn(300);
        	$('#textBoxButtons').fadeIn(300);
        	$('#m').fadeIn(300);
        	$('#sendBut').fadeIn(300);
        });
    });
    socket.on('loginfailure',function(){ //dialog box that login failed
    	alert("Invalid Login Info, please try again");
    });
    socket.on('createfailure',function(){ //dialog box that create failed
    	alert("Account Creation Failed, username and password fields required");
    });
    socket.on('createtaken',function(){ //dialog box that username already taken
    	alert("Account Creation Failed, username already taken");
    });
    socket.on('createsuccess',function(){ //dialog box that create succeeded
    	alert("Account Created, please login");
    	$('#createoverlay').toggle(300, function() {$('#overlay').toggle(300); });
    });
  });
</script>
  </body>
</html>
